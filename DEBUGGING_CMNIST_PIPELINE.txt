Dataset: CMNIST Easy

Open Q: For Group DRO, when we're dealing with multiple group membership, what's the best way to reweight groups?
- Current: Reweight based on group intersection counts (weight = len(dataset) / num points with exact same group membership as me)

Regular Group DRO:
Val Robust Worst Group val   acc (early stop at epoch 4): 92.8
Val Robust Worst Group test  acc (early stop at epoch 4): 91.1
Val Average Acc val   acc (early stop at epoch 4): 95.3
Val Average Acc test  acc (early stop at epoch 4): 95.2
group 0 acc val   acc (early stop at epoch 4): 93.6
group 0 acc test  acc (early stop at epoch 4): 94.9
group 1 acc val   acc (early stop at epoch 4): 97.4
group 1 acc test  acc (early stop at epoch 4): 97.7
group 2 acc val   acc (early stop at epoch 4): 97.5
group 2 acc test  acc (early stop at epoch 4): 96.9
group 3 acc val   acc (early stop at epoch 4): 92.8
group 3 acc test  acc (early stop at epoch 4): 91.1

Faked Groups + Group DRO - 0 = everyone, 1 = target, 2 = confounder:
Val Robust Worst Group val   acc (early stop at epoch 4): 95.4
Val Robust Worst Group test  acc (early stop at epoch 4): 92.2
Val Average Acc val   acc (early stop at epoch 4): 95.6
Val Average Acc test  acc (early stop at epoch 4): 96.0
group 0 acc val   acc (early stop at epoch 4): 95.7
group 0 acc test  acc (early stop at epoch 4): 96.0
group 1 acc val   acc (early stop at epoch 4): 95.4
group 1 acc test  acc (early stop at epoch 4): 98.3
group 2 acc val   acc (early stop at epoch 4): 95.4
group 2 acc test  acc (early stop at epoch 4): 97.2
group 3 acc test  acc (early stop at epoch 4): 92.2

Faked Groups + Group DRO - 0 = everyone, 1 = target, 2 = confounder, 3 = not target, 4 = not counfounder:
Val Robust Worst Group val   acc (early stop at epoch 4): 95.0
Val Robust Worst Group test  acc (early stop at epoch 4): 91.9
Val Average Acc val   acc (early stop at epoch 4): 96.0
Val Average Acc test  acc (early stop at epoch 4): 95.7
group 0 acc val   acc (early stop at epoch 4): 96.0
group 0 acc test  acc (early stop at epoch 4): 97.0
group 1 acc val   acc (early stop at epoch 4): 95.0
group 1 acc test  acc (early stop at epoch 4): 98.0
group 2 acc val   acc (early stop at epoch 4): 95.4
group 2 acc test  acc (early stop at epoch 4): 95.6
group 3 acc val   acc (early stop at epoch 4): 97.0
group 3 acc test  acc (early stop at epoch 4): 91.9
group 4 acc val   acc (early stop at epoch 4): 96.6

Binarized Faked Groups + Group DRO - 0 = everyone, 1 = target, 2 = confounder:


Binarized Faked Groups + Group DRO - 0 = everyone, 1 = target, 2 = confounder, 3 = not target, 4 = not counfounder:
Val Robust Worst Group val   acc (early stop at epoch 4): 93.4
Val Robust Worst Group test  acc (early stop at epoch 4): 91.7
Val Average Acc val   acc (early stop at epoch 4): 95.7
Val Average Acc test  acc (early stop at epoch 4): 95.6
group 0 acc val   acc (early stop at epoch 4): 93.4
group 0 acc test  acc (early stop at epoch 4): 95.6
group 1 acc val   acc (early stop at epoch 4): 97.4
group 1 acc test  acc (early stop at epoch 4): 98.0
group 2 acc val   acc (early stop at epoch 4): 97.3
group 2 acc test  acc (early stop at epoch 4): 96.7
group 3 acc val   acc (early stop at epoch 4): 94.6
group 3 acc test  acc (early stop at epoch 4): 91.7

Faked Groups + Group DRO - 1 = target, 2 = confounder:
Val Robust Worst Group val   acc (early stop at epoch 4): 92.8
Val Robust Worst Group test  acc (early stop at epoch 4): 91.1
Val Average Acc val   acc (early stop at epoch 4): 95.3
Val Average Acc test  acc (early stop at epoch 4): 95.2
group 0 acc val   acc (early stop at epoch 4): 93.6
group 0 acc test  acc (early stop at epoch 4): 94.9
group 1 acc val   acc (early stop at epoch 4): 97.4
group 1 acc test  acc (early stop at epoch 4): 97.7
group 2 acc val   acc (early stop at epoch 4): 97.5
group 2 acc test  acc (early stop at epoch 4): 96.9
group 3 acc val   acc (early stop at epoch 4): 92.8
group 3 acc test  acc (early stop at epoch 4): 91.1

Faked Groups + Group DRO - 1 = target, 2 = confounder, 3 = not target, 4 = not counfounder:
Val Robust Worst Group val   acc (early stop at epoch 4): 92.8
Val Robust Worst Group test  acc (early stop at epoch 4): 91.1
Val Average Acc val   acc (early stop at epoch 4): 95.3
Val Average Acc test  acc (early stop at epoch 4): 95.2
group 0 acc val   acc (early stop at epoch 4): 93.6
group 0 acc test  acc (early stop at epoch 4): 94.9
group 1 acc val   acc (early stop at epoch 4): 97.4
group 1 acc test  acc (early stop at epoch 4): 97.7
group 2 acc val   acc (early stop at epoch 4): 97.5
group 2 acc test  acc (early stop at epoch 4): 96.9
group 3 acc val   acc (early stop at epoch 4): 92.8
group 3 acc test  acc (early stop at epoch 4): 91.1


Current Find Groups

Conclusion:
- Having the everything group gives us slightly better perf than standard GDRO
- group symmetry doesn't matter
- idt this binarization shit matters either
- Our current reweighting scheme for GDRO with overlapping groups gives us GDRO so I think it's chill?